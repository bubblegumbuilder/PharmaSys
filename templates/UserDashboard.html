<!DOCTYPE html>
<html lang="en">
    <!--This portion of the code declares the values that will be present in the header. The header is the text on the tab overview-->
    <head>
        <!--declare what are the characters involved-->
        <meta charset="utf-8">
        <!--This line is what declares the website to be flexible with the user's screen. without it, it cannot be cross compatible between phones and computers-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <!--Link to our custom utility CSS-->
        <link   
            rel="stylesheet" 
            href="{{ url_for('static', filename='TheBranding.css') }}"
        >
        <!--below this is the line that will show on the page head-->
        <title>
            Dashboard
        </title>
    </head>

<body>
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1>PharmaSys</h1>
        </div>
        <nav class="sidebar-nav">
            <a href="#" data-tab="dashboard" class="nav-link active">Dashboard</a>
            <a href="#" data-tab="users" class="nav-link">Users</a>
            <a href="#" data-tab="inventory" class="nav-link">Inventory</a>
            <a href="#" data-tab="receipts" class="nav-link">Receipts</a>
        </nav>
    </aside>

    <!-- MAIN CONTENT AREA -->
    <main class="main-content">
        <!-- Dashboard Tab -->
        <section id="dashboard-section">
            <h1 class="section-title">Dashboard</h1>
            <div class="dashboard-card">
                <div class="dashboard-info">
                    <p id="current-admin"><strong>Logged in as:</strong> {{ current_user }}</p>
                    <p id="account-count"><strong>Accounts registered:</strong> {{ user_count }}</p>
                    <p id="time-on-screen"><strong>Time on screen:</strong> 0s</p>
                </div>
                <button id="logout-btn" class="logout-btn">Logout</button>
            </div>
        </section>

        <!-- Users Tab -->
        <section id="users-section" class="hidden">
            <h2 class="section-title">User Accounts</h2>
            <div class="table-container">
                <table id="users-table" class="data-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
                <div id="users-loading" class="loading-message">Loading user data...</div>
            </div>
        </section>

        <!-- Inventory Tab -->
        <section id="inventory-section" class="hidden">
            <h2 class="section-title">Drug Inventory</h2>
            <div class="table-container">
                <table id="inventory-table" class="data-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
                <div id="inventory-loading" class="loading-message">Loading inventory data...</div>
            </div>
        </section>

        <!-- Receipts Tab -->
        <section id="receipts-section" class="hidden">
            <h2 class="section-title">Receipts</h2>
            <div class="table-container">
                <table id="receipts-table" class="data-table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
                <div id="receipts-loading" class="loading-message">Loading receipts data...</div>
            </div>
        </section>
    </main>

    <script>
        const startTime = Date.now();

        // Tab navigation
        document.querySelectorAll('.nav-link[data-tab]').forEach(function(link) {
            link.addEventListener('click', function(e) {
                e.preventDefault();

                // Update active link styling
                document.querySelectorAll('.nav-link').forEach(function(navLink) {
                    navLink.classList.remove('active');
                });
                this.classList.add('active');

                // Show/hide sections
                const tab = this.dataset.tab;
                document.querySelectorAll('main section').forEach(function(section) {
                    section.classList.add('hidden');
                });
                document.getElementById(tab + '-section').classList.remove('hidden');
            });
        });

        // Update "time on screen" every second
        setInterval(function() {
            const secs = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('time-on-screen').innerHTML = '<strong>Time on screen:</strong> ' + secs + 's';
        }, 1000);

        // Logout button
        document.getElementById('logout-btn').addEventListener('click', function() {
            window.location.href = 'Web_LogIn.html';
        });

        // TODO: Replace the function below with a fetch() to call Flask endpoints returning JSON data
        function populateTable(data, tableId, loadingId) {
            const table = document.getElementById(tableId);
            const loadingDiv = document.getElementById(loadingId);
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');

            if (!data || data.length === 0) {
                if (loadingDiv) {
                    loadingDiv.textContent = 'No data available';
                }
                return;
            }

            thead.innerHTML = '';
            tbody.innerHTML = '';

            // Create headers
            const headerRow = document.createElement('tr');
            Object.keys(data[0]).forEach(function(col) {
                const th = document.createElement('th');
                th.textContent = col.charAt(0).toUpperCase() + col.slice(1);
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            // Create rows
            data.forEach(function(row) {
                const tr = document.createElement('tr');
                Object.values(row).forEach(function(val) {
                    const td = document.createElement('td');
                    td.textContent = val || '';
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            if (loadingDiv) {
                loadingDiv.style.display = 'none';
            }
        }

        // TODO: Fetch JSON from Flask endpoints and call populateTable()
        // Example:
        // fetch('/api/users')
        //     .then(res => res.json())
        //     .then(data => populateTable(data, 'users-table', 'users-loading'));

    </script>
</body>
</html>
